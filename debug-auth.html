<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Debug - Auth & Data</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
    
    const supabaseUrl = 'https://zgdxszwjbbxepsvyjtrb.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpnZHhzendqYmJ4ZXBzdnlqdHJiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MTU4MTAsImV4cCI6MjA3NDk5MTgxMH0.NZdEYYCOZlMUo5h7TM-gsSTxmgMx7ta9W_gsi7ZNHCA'
    const supabase = createClient(supabaseUrl, supabaseKey)

    async function debug() {
      const output = document.getElementById('output')
      output.innerHTML = '<h2>Verificando autentica√ß√£o e dados...</h2>'
      
      try {
        // 1. Verificar usu√°rio autenticado
        const { data: { user }, error: userError } = await supabase.auth.getUser()
        
        if (userError) {
          output.innerHTML += '<p style="color:red">‚ùå Erro ao buscar usu√°rio: ' + userError.message + '</p>'
          return
        }
        
        if (!user) {
          output.innerHTML += '<p style="color:red">‚ùå Nenhum usu√°rio autenticado</p>'
          return
        }
        
        output.innerHTML += '<h3>‚úÖ Usu√°rio Autenticado:</h3>'
        output.innerHTML += '<pre>' + JSON.stringify(user, null, 2) + '</pre>'
        
        const userId = user.id
        
        // 2. Buscar pacientes
        output.innerHTML += '<h3>Buscando Pacientes (user_id = ' + userId + '):</h3>'
        const { data: patients, error: patientsError } = await supabase
          .from('patients')
          .select('*')
          .eq('user_id', userId)
        
        if (patientsError) {
          output.innerHTML += '<p style="color:red">‚ùå Erro ao buscar pacientes: ' + patientsError.message + '</p>'
        } else {
          output.innerHTML += '<p>‚úÖ Encontrados: ' + (patients?.length || 0) + ' pacientes</p>'
          output.innerHTML += '<pre>' + JSON.stringify(patients, null, 2) + '</pre>'
        }
        
        // 3. Buscar profissionais
        output.innerHTML += '<h3>Buscando Profissionais (user_id = ' + userId + '):</h3>'
        const { data: professionals, error: profsError } = await supabase
          .from('professionals')
          .select('*')
          .eq('user_id', userId)
        
        if (profsError) {
          output.innerHTML += '<p style="color:red">‚ùå Erro ao buscar profissionais: ' + profsError.message + '</p>'
        } else {
          output.innerHTML += '<p>‚úÖ Encontrados: ' + (professionals?.length || 0) + ' profissionais</p>'
          output.innerHTML += '<pre>' + JSON.stringify(professionals, null, 2) + '</pre>'
        }
        
        // 4. Buscar estoque
        output.innerHTML += '<h3>Buscando Estoque (user_id = ' + userId + '):</h3>'
        const { data: stock, error: stockError } = await supabase
          .from('stock')
          .select('*')
          .eq('user_id', userId)
        
        if (stockError) {
          output.innerHTML += '<p style="color:red">‚ùå Erro ao buscar estoque: ' + stockError.message + '</p>'
        } else {
          output.innerHTML += '<p>‚úÖ Encontrados: ' + (stock?.length || 0) + ' itens</p>'
          output.innerHTML += '<pre>' + JSON.stringify(stock, null, 2) + '</pre>'
        }
        
      } catch (err) {
        output.innerHTML += '<p style="color:red">‚ùå Erro geral: ' + err.message + '</p>'
        console.error(err)
      }
    }
    
    window.onload = debug
  </script>
</head>
<body style="font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff;">
  <h1>üîç Debug - Autentica√ß√£o e Dados</h1>
  <div id="output"></div>
</body>
</html>
